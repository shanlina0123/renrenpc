<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>修改密码</title>
     <link rel="icon" href="../../images/icon.ico">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../css/normalize.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../layui-v2.2.6/layui/css/layui.css">
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <link rel="stylesheet" href="../../css/style1.css">
     <link rel="stylesheet" href="../../css/style2.css">
</head>
<body>
    <div class="wrap">
        <div class="layui-layout layui-layout-admin" id="top"></div>
        <div class="main clearfix">
            <!--左侧导航-->
            <ul class="leftNav fl" id="left"><!--左侧导航--></ul>
            <!--右侧主要内容-->
            <div class="rightMain indexRightMain fl">
            	 <div class="layui-layout">
		            <div class="loginErweima">
		                <div class="erweima" id="code"></div>
		                <p class="loginNotice">
		                    <span>二维码两分钟之内有效</span>
		                    <a href="#" class="reload">刷新二维码</a>
		                </p>
		            </div>
		        </div>
            </div>
        </div>
    </div>
    <!-- //wrap -->
    <script type="text/javascript" src="../../js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="../../config/configure.js?v=2"></script>
    <script type="text/javascript" src="../../layui-v2.2.6/layui/layui.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
    <script>
        if( localStorage.getItem("userinfo") )
        {
            var id = JSON.parse(localStorage.getItem("userinfo")).token;
            var back = conf.authorization+'authorization.html?uuid='+id+"&type=2";
            back = encodeURIComponent(back);
            var str = "https://open.weixin.qq.com/connect/oauth2/authorize?appid="+conf.appid+"&redirect_uri="+back+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect";
            $('#code').qrcode(str);


            var tokenData = localStorage.getItem("userinfo");
            var uuid = JSON.parse(tokenData).uuid;
            var num = 0;
            var i = setInterval(function()
            {
                num++;
                $.post(conf.wechat_testing,{uuid:uuid},function ( res ) {
                    if( res )
                    {
                        if( res.status == 1 )
                        {
                            var openid = res.data.wechatopenid;
                            var tokenData = localStorage.getItem("userinfo");
                            var data = JSON.parse(tokenData);
                            data.wechatopenid = openid;
                            var data = JSON.stringify( data );
                            localStorage.setItem('userinfo',data);
                            window.location.href='cgpwd.html';
                        }
                    }
                },'json');
                if ( num > 90 )
                {
                    $('#code').html('');
                    clearInterval(i);
                }
            }, 3000);
        }

    </script>
</body>
</html>
