<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>添加房源第四步</title>
    <meta name="description" content="">
    <link rel="icon" href="../../images/icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../css/normalize.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/style1.css">
    <link rel="stylesheet" href="../../layui-v2.2.6/layui/css/layui.css">
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <link rel="stylesheet" href="../../css/index.css">
</head>
<style type="text/css">
	
</style>

<body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <div class="wrap">
        <div class="layui-layout layui-layout-admin">
            <!--顶部-->
               <div class="layui-header header">
                <a href="../index/index.html" class="logo fl"><img src="../../images/logo.png"></a>
                <ul class="layui-nav handelUl">
                    <li class="layui-nav-item">
                        <a href="javascript:;">
                            <img src="../../images/uHead.jpg" class="layui-circle" width="35" height="35">
                            <cite><span>管理员</span>，你好！</cite>
                            <span class="layui-nav-more"></span>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="../index/cgLogin.html"><i class="iconfont icon-shezhi1" data-icon="icon-shezhi1"></i><cite>修改密码</cite></a></dd>
                            <dd><a href="../index/login.html" class="signOut"><i class="iconfont icon-loginout"></i><cite>退出</cite></a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main clearfix">
            <!--左侧导航-->
            <ul class="leftNav fl">
                <li>
                    <a href="../roles/roles.html">角色管理</a>
                   
                </li>
                <li>
                    <a href="../admin/admin.html">用户管理</a>                 
                </li>
                <li>
                    <a href="javascript:;" class="on">房源管理</a>
                    <ul class="leftSubNav">
                        <li><a href="../house/addHouseStep1.html">添加房源</a></li>
                        <li><a href="../house/houseList.html">房源列表</a></li>
                    </ul>
                </li>
                <li>
                    <a href="../company/companylist.html">公司管理</a>
                </li>
                <li>
                    <a href="../client/client.html">客户管理</a>
                   
                </li>
                <li>
                    <a href="../user/user.html">经纪人管理</a>
                </li>
                <li>
                    <a href="../charts/charts.html">数据分析</a>
                </li>
                <li>
                    <a href="../datas/setting.html">系统配置</a>
                </li>
            </ul>      <!--客户数据表格-->
            <div class="rightMain fl">
                <!-- 添加房源流程-->
                <div class="cartFlow clearfix">
                    <!-- 第一步-->
                    <div class="flow on">
                        <div class="flowBgWrap">
                            <div class="flowBg"></div>
                            <span class="flowNum">1</span>
                        </div>
                        <div class="flowDes">1、选择房源</div>
                    </div>
                    <!-- 第二步-->
                    <div class=" flow on">
                        <div class="flowBgWrap">
                            <div class="flowBg"></div>
                            <span class="flowNum">2</span>
                        </div>
                        <div class="flowDes">2、填写房源信息</div>
                    </div>
                    <!-- 第三步-->
                    <div class=" flow on">
                        <div class="flowBgWrap">
                            <div class="flowBg"></div>
                            <span class="flowNum">3</span>
                        </div>
                        <div class="flowDes">3、添加房源特色</div>
                    </div>
                    <!-- 第四步-->
                    <div class=" flow on">
                        <div class="flowBgWrap">
                            <div class="flowBg"></div>
                            <span class="flowNum">4</span>
                        </div>
                        <div class="flowDes">4、上传图片</div>
                    </div>
                    <!-- 第五步-->
                    <div class=" flow">
                        <div class="flowBgWrap">
                            <div class="flowBg"></div>
                            <span class="flowNum">5</span>
                        </div>
                        <div class="flowDes">5、添加成功</div>
                    </div>
                </div>
                <!--上传图片表单-->
                <div class="formWrap">
                    <form class="layui-form" action="addHouseStep5.html">
                        <table class="uploadTable">
                            <!--<tr>
                                <td>封面图(单张)</td>
                                <td>
                                    <div class="layui-upload">
                                        <button type="button" class="layui-btn" id="test1">上传图片</button>
                                        <div class="layui-upload-list">
                                            <img class="layui-upload-img" id="demo1">
                                            <p id="demoText"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>-->
                            <!--<tr>
                                <td>详情图</td>
                                <td>
                                    <div class="layui-upload">
                                        <button type="button" class="layui-btn" id="test2">多图片上传</button>
                                        <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                                            预览图：
                                            <div class="layui-upload-list" id="demo2"></div>
                                        </blockquote>
                                    </div>
                                    <div>支持JPG、PNG、JPEG,最多可上传9张</div>
                                </td>
                            </tr>-->
                            <tr>
                            <div class="img-box full">
								<section class=" img-section">
									<p class="up-p">多图片上传：<span class="up-span">最多可以上传5张图片，马上上传</span></p>
									<div class="z_photo upimg-div clear" >			   
											 <section class="z_file fl">
												<img src="../../images/a11.png" class="add-img">
												<input type="file" name="file" id="file" class="file" value="" accept="image/jpg,image/jpeg,image/png,image/bmp" multiple />
											 </section>
									 </div>
								 </section>
							</div>
							</tr>
							<aside class="mask works-mask">
								<div class="mask-content">
									<p class="del-p ">您确定要删除作品图片吗？</p>
									<p class="check-p"><span class="del-com wsdel-ok">确定</span><span class="wsdel-no">取消</span></p>
								</div>
							</aside>
            
<!--
							<tr>
                                <td>公众号显示</td>
                                <td>
                                    <div class="layui-form-item">
                                        <div class="layui-input-block forEditLeftMargin">
                                            <input type="radio" name="isShow" value="是" title="是" checked="">
                                            <input type="radio" name="isShow" value="否" title="否">
                                        </div>
                                    </div>
                                </td>
                            </tr>-->
                        </table>
                        <div class="nextBtnWrap">
                            <button class="layui-btn nextBtn" lay-submit=" " lay-filter="filter1">下一步</button>
                        </div>
                    </form>
                </div>
          
     </div>
            <!-- //wrap -->
            <script type="text/javascript" src="../../js/jquery-3.3.1.min.js"></script>
            <script type="text/javascript" src="../../layui-v2.2.6/layui/layui.js" charset="utf-8"></script>
            <script type="text/javascript" src="../../js/common.js"></script>
            <script type="text/javascript">
                layui.use(['form'], function() {
                    var form = layui.form;
                });
            </script>
            <script type="text/javascript">
				$(function(){
				var delParent;
				var defaults = {
					fileType         : ["jpg","png","bmp","jpeg"],   // 上传文件的类型
					fileSize         : 1024 * 1024 * 10                  // 上传文件的大小 10M
				};
					/*点击图片的文本框*/
				$(".file").change(function(){	 
					var idFile = $(this).attr("id");
					var file = document.getElementById(idFile);
					var imgContainer = $(this).parents(".z_photo"); //存放图片的父亲元素
					var fileList = file.files; //获取的图片文件
					var input = $(this).parent();//文本框的父亲元素
					var imgArr = [];
					//遍历得到的图片文件
					var numUp = imgContainer.find(".up-section").length;
					var totalNum = numUp + fileList.length;  //总的数量
					if(fileList.length > 5 || totalNum > 5 ){
						alert("上传图片数目不可以超过5个，请重新选择");  //一次选择上传超过5个 或者是已经上传和这次上传的到的总数也不可以超过5个
					}
					else if(numUp < 5){
						fileList = validateUp(fileList);
						for(var i = 0;i<fileList.length;i++){
						 var imgUrl = window.URL.createObjectURL(fileList[i]);
						     imgArr.push(imgUrl);
						 var $section = $("<section class='up-section fl loading'>");
						     imgContainer.prepend($section);
						 var $span = $("<span class='up-span'>");
						     $span.appendTo($section);
						
					     var $img0 = $("<img class='close-upimg'>").on("click",function(event){
							    event.preventDefault();
								event.stopPropagation();
								$(".works-mask").show();
								delParent = $(this).parent();
							});   
							$img0.attr("src","../../images/a7.png").appendTo($section);
					     var $img = $("<img class='up-img up-opcity'>");
					         $img.attr("src",imgArr[i]);
					         $img.appendTo($section);
					     var $p = $("<p class='img-name-p'>");
					         $p.html(fileList[i].name).appendTo($section);
					     var $input = $("<input id='taglocation' name='taglocation' value='' type='hidden'>");
					         $input.appendTo($section);
					     var $input2 = $("<input id='tags' name='tags' value='' type='hidden'/>");
					         $input2.appendTo($section);
					      
					   }
					}
					setTimeout(function(){
			             $(".up-section").removeClass("loading");
					 	 $(".up-img").removeClass("up-opcity");
					 },450);
					 numUp = imgContainer.find(".up-section").length;
					if(numUp >= 5){
						$(this).parent().hide();
					}
				});
				
				
			   
			    $(".z_photo").delegate(".close-upimg","click",function(){
			     	  $(".works-mask").show();
			     	  delParent = $(this).parent();
				});
					
				$(".wsdel-ok").click(function(){
					$(".works-mask").hide();
					var numUp = delParent.siblings().length;
					if(numUp < 6){
						delParent.parent().find(".z_file").show();
					}
					 delParent.remove();
				});
				
				$(".wsdel-no").click(function(){
					$(".works-mask").hide();
				});
		
		function validateUp(files){
			var arrFiles = [];//替换的文件数组
			for(var i = 0, file; file = files[i]; i++){
				//获取文件上传的后缀名
				var newStr = file.name.split("").reverse().join("");
				if(newStr.split(".")[0] != null){
						var type = newStr.split(".")[0].split("").reverse().join("");
						console.log(type+"===type===");
						if(jQuery.inArray(type, defaults.fileType) > -1){
							// 类型符合，可以上传
							if (file.size >= defaults.fileSize) {
								alert(file.size);
								alert('您这个"'+ file.name +'"文件大小过大');	
							} else {
								// 在这里需要判断当前所有文件中
								arrFiles.push(file);	
							}
						}else{
							alert('您这个"'+ file.name +'"上传类型不符合');	
						}
					}else{
						alert('您这个"'+ file.name +'"没有类型, 无法识别');	
					}
			}
			return arrFiles;
		}
		
	
	
})
           
            </script>
</body>

</html>